@inject IUsuariosInterface UsuariosService
@inject IPermisosInterface PermisosService
@inject AuthenticationStateProvider AuthenticationStateProvider

<div id="modal" class="modal" style='display: @(ActivarModal ? "block" : "none")'>
    <div class="modal-content">
        <EditForm Model="perfil" OnValidSubmit="ActualizarPerfil">
            <DataAnnotationsValidator />
            <div class="modal-header d-flex justify-content-center ">
                <h2 class="text-profile blue-dark-text">Perfil <img class="mb-3" src="images/Perfil/Icono-de-usuario.png" /></h2>
            </div>

            <div class="modal-body d-flex row g-2 text-start">
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="correo">Correo:</label>
                    <input @bind-value="@perfil.correo" class="col-md-4 border border-success rounded-pill px-2 text-input " type="text" id="correo" @oninput="CambioCorreo" />
                </div>
                <ValidationMessage For="@(() => perfil.correo)" />
                @if (!string.IsNullOrEmpty(mensajeCorreoRepite))
                {
                    <MensajeRepite Message="@mensajeCorreoRepite" />
                }
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="usuario">Usuario:</label>
                    <input @bind-value="@perfil.usuario" class="col-md-4 border border-success rounded-pill px-2 text-input " type="text" id="usuario" @oninput="CambioUsuario" />
                </div>
                <ValidationMessage For="@(() => perfil.usuario)" />
                @if (!string.IsNullOrEmpty(mensajeUsuarioRepite))
                {
                    <MensajeRepite Message="@mensajeUsuarioRepite" />
                }
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="contraseña">Contraseña:</label>
                    <input class="col-md-4 border border-success rounded-pill px-2 text-input " type="password" id="contraseña" @oninput="CambioClave" />
                </div>
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="empresa">Empresa:</label>
                    <input @bind-value="@perfil.nombre" class="col-md-4 border border-success rounded-pill px-2 text-input " type="text" id="empresa" @oninput="CambioNombreEmpresa" />
                </div>
                <ValidationMessage For="@(() => perfil.nombre)" />
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="telefono">Telefono:</label>
                    <input @bind-value="@perfil.telefono" class="col-md-4 border border-success rounded-pill px-2 text-input " type="text" id="telefono" @oninput="CambioTelefono" />
                </div>
                <ValidationMessage For="@(() => perfil.telefono)" />
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="esquema">Esquema:</label>
                    <select @bind="perfil.esquema" class="col-md-4 border border-success rounded-pill green-bg text-light px-2 text-input" id="esquema" @oninput="CambioEsquema">
                        <option value="BSP">BSP</option>
                    </select>
                </div>
                @if(rol == "Admin"){
                <div class="d-flex justify-content-center">
                    <label class="col-md-4  blue-dark-text label-text" for="tipo">Tipo:</label>
                    <select @bind="perfil.rol" class="col-md-4 border border-success rounded-pill green-bg text-light px-2 text-input" id="tipo" @oninput="CambioRol">
                        <option value="Usuario">Usuario</option>
                        <option value="Admin">Administrador</option>
                    </select>
                </div>
                <ValidationMessage For="@(() => perfil.rol)" />
                <div class="d-flex justify-content-center mt-3">
                    <label class="col-md-4  blue-dark-text label-text text-start ps-5" for="permisos">Permisos:</label>
                    <div id="permisos" class="row col-md-6 px-2 text-input text-start d-flex align-items-center justify-content-center">
                        @if (todosLosPermisos != null)
                        {

                            foreach (var permiso in todosLosPermisos)
                            {
    
                                
                                <div class="col-md-4 ms-4">
                                    <input type="checkbox" class="custom-checkbox" id="myCheckbox-@permiso.Id" checked="@permiso.EstadoCheck" @onchange="(e) => HandleCheckCambiado(e, permiso.Id)">
                                    <label class="label-transparent" for="myCheckbox-@permiso.Id">@permiso.permiso</label>
                                </div>

                            }
                        }


                    </div>
                </div>
                }
            </div>

            <div class="modal-footer">
                <div @onclick="() => CloseModal()" class="button-footer mouse-pointer rounded-pill border border-primary blue-light-bg text-light button-text mx-4" id="descartar-perfil">Descartar cambios</div>
                <button type="submit" class="button-footer rounded-pill border border-success green-bg text-light button-text mx-4" id="guardar-perfil">Guardar cambios</button>
            </div>

        </EditForm>
    </div>
</div>


